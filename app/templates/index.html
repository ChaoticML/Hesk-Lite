{% extends 'layout.html' %}
{% block title %}Actieve Tickets{% endblock %}

{% block content %}
    <h1>Actieve Tickets</h1>
    
    <div class="filter-container">
        <!-- Het formulier verstuurt geen verborgen user/password velden meer -->
        <form method="get" action="{{ url_for('main.index') }}">
            <!-- VERWIJDERD: De hidden inputs voor user en password zijn niet meer nodig. -->
            
            <div class="form-group">
                <label for="search">Zoek:</label>
                <input type="search" id="search" name="search" placeholder="Zoek op trefwoord..." value="{{ search_query or '' }}">
            </div>

            <div class="form-group">
                <label for="filter">Filter:</label>
                <select id="filter" name="filter">
                    <option value="all" {% if filter_by == 'all' %}selected{% endif %}>Alle Actieve Tickets</option>
                    <option value="mine" {% if filter_by == 'mine' %}selected{% endif %}>Mijn Tickets</option>
                    <option value="unassigned" {% if filter_by == 'unassigned' %}selected{% endif %}>Niet-toegewezen</option>
                </select>
            </div>

            <div class="form-group">
                <label for="sort">Sorteer op:</label>
                <select id="sort" name="sort">
                    <option value="created_at_desc" {% if sort_by == 'created_at_desc' %}selected{% endif %}>Datum (Nieuwste eerst)</option>
                    <option value="created_at_asc" {% if sort_by == 'created_at_asc' %}selected{% endif %}>Datum (Oudste eerst)</option>
                    <option value="priority" {% if sort_by == 'priority' %}selected{% endif %}>Prioriteit (Hoog > Laag)</option>
                    <option value="status" {% if sort_by == 'status' %}selected{% endif %}>Status</option>
                </select>
            </div>
            
            <button type="submit" class="filter-button">Toepassen</button>
        </form>
    </div>

    {% for ticket in tickets %}
        <!-- Ik voeg een extra class toe voor de status, handig voor styling -->
        <div class="ticket-summary priority-{{ ticket.priority.lower() }} status-{{ ticket.status | lower | replace(' ', '-') }}">
            <!-- De link naar view_ticket bevat geen user/password parameters meer -->
            <h3><a href="{{ url_for('main.view_ticket', ticket_id=ticket.id) }}">#{{ ticket.id }} - {{ ticket.title }}</a></h3>
            <p>
                <strong>Status:</strong> {{ ticket.status }} |
                <strong>Prioriteit:</strong> {{ ticket.priority }} |
                <strong>Aanvrager:</strong> {{ ticket.requester_name }}
            </p>
            <p>
                <strong>Aangemaakt:</strong> {{ ticket.created_at | datetimeformat }} |
                <strong>Toegewezen aan:</strong> {% if ticket.assigned_to %}{{ ticket.assigned_to }}{% else %}Niemand{% endif %}
            </p>
        </div>
    {% else %}
        <p>Geen actieve tickets gevonden die aan de criteria voldoen.</p>
    {% endfor %}
{% endblock %}