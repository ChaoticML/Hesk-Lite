{% extends 'layout.html' %}
{% block title %}Actieve Tickets{% endblock %}

{% block content %}
    <div class="page-header">
        <h1>Actieve Tickets</h1>
        <!-- De "Nieuw Ticket" knop is nu in de hoofdnavigatie, dus hier niet per se nodig,
             maar kan als extra call-to-action worden toegevoegd indien gewenst. -->
    </div>
    
    <div class="filter-container">
        <form method="get" action="{{ url_for('main.index') }}">
            <div class="form-group">
                <label for="search">Zoek:</label>
                <input type="search" id="search" name="search" placeholder="Zoek op trefwoord..." value="{{ search_query or '' }}">
            </div>

            <div class="form-group">
                <label for="filter">Filter:</label>
                <select id="filter" name="filter">
                    <option value="all" {% if filter_by == 'all' %}selected{% endif %}>Alle Actieve Tickets</option>
                    <option value="mine" {% if filter_by == 'mine' %}selected{% endif %}>Mijn Tickets</option>
                    <option value="unassigned" {% if filter_by == 'unassigned' %}selected{% endif %}>Niet-toegewezen</option>
                </select>
            </div>

            <div class="form-group">
                <label for="sort">Sorteer op:</label>
                <select id="sort" name="sort">
                    <option value="created_at_desc" {% if sort_by == 'created_at_desc' %}selected{% endif %}>Datum (Nieuwste eerst)</option>
                    <option value="created_at_asc" {% if sort_by == 'created_at_asc' %}selected{% endif %}>Datum (Oudste eerst)</option>
                    <option value="priority" {% if sort_by == 'priority' %}selected{% endif %}>Prioriteit</option>
                    <option value="status" {% if sort_by == 'status' %}selected{% endif %}>Status</option>
                </select>
            </div>
            
            <button type="submit" class="filter-button">Toepassen</button>
        </form>
    </div>

    <div class="ticket-list">
        {% for ticket in tickets %}
            <div class="ticket-summary priority-{{ ticket.priority.lower() }} status-{{ ticket.status | lower | replace(' ', '-') }}">
                <div class="ticket-main-info">
                    <h3>
                        <a href="{{ url_for('main.view_ticket', ticket_id=ticket.id) }}">
                            <span class="ticket-id">#{{ ticket.id }}</span> - {{ ticket.title }}
                        </a>
                    </h3>
                    <div class="ticket-meta">
                        <span><strong>Aanvrager:</strong> {{ ticket.requester_name }}</span>
                        <span><strong>Aangemaakt:</strong> {{ ticket.created_at | datetimeformat }}</span>
                    </div>
                </div>
                <div class="ticket-status-info">
                    <span class="ticket-tag status-tag">Status: {{ ticket.status }}</span>
                    <span class="ticket-tag priority-tag">Prioriteit: {{ ticket.priority }}</span>
                    <span class="ticket-tag assigned-tag">Toegewezen aan: {% if ticket.assigned_to %}{{ ticket.assigned_to }}{% else %}Niemand{% endif %}</span>
                </div>
            </div>
        {% else %}
            <div class="empty-state">
                <h2>Geen actieve tickets gevonden</h2>
                <p>Er zijn momenteel geen actieve tickets die aan uw criteria voldoen.</p>
                <a href="{{ url_for('main.create') }}" class="submit-button">Maak het eerste ticket aan</a>
            </div>
        {% endfor %}
    </div>
{% endblock %}